<script>
(async function logout() {
  const cookiesToClear = ["username", "picture", "usingotheroptions", "usingmicrosoftaccount", "iniframe", "inapp"];
  const cookieValues = {};
  document.cookie.split(";").forEach(c => {
    const [k, v] = c.trim().split("=");
    if (k && v) cookieValues[k] = decodeURIComponent(v);
  });

  const username = cookieValues.username || "";
  const provider =
    cookieValues.usingmicrosoftaccount === "true" ? "microsoft" :
    cookieValues.usingotheroptions === "true" ? "google" :
    "";

  cookiesToClear.forEach(c => {
    document.cookie = `${c}=; max-age=0; path=/; SameSite=None; Secure`;
  });

  if (provider && username) {
    await fetch("https://dominic.eu5.org/TSAS/socialLogout/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name: username, provider: provider })
    }).catch(() => {});
  }

  if (window.self !== window.top) {
    window.parent.location.href = "../../startsession";
  } else {
    window.location.href = "../../";
  }
})();
</script>
